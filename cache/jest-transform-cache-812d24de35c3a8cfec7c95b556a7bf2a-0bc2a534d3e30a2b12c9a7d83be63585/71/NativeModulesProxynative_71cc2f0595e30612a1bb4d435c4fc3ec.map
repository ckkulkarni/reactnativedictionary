{"version":3,"names":["_reactNative","require","_global$expo","LegacyNativeProxy","NativeModules","NativeUnimoduleProxy","ExpoNativeProxy","global","expo","modules","NativeModulesProxy","modulesConstantsKey","exportedMethodsKey","NativeProxy","Object","keys","forEach","moduleName","methodInfo","name","_len","arguments","length","args","Array","_key","callMethod","key","argumentsCount","Promise","reject","Error","concat","EXReactNativeEventEmitter","addListener","_NativeModules$EXReac","_len2","_key2","addProxiedListener","apply","removeListeners","_NativeModules$EXReac2","_len3","_key3","removeProxiedListeners","console","warn","_default","exports"],"sources":["../src/NativeModulesProxy.native.ts"],"sourcesContent":["import { NativeModules } from 'react-native';\n\nimport { ProxyNativeModule } from './NativeModulesProxy.types';\n\nconst LegacyNativeProxy = NativeModules.NativeUnimoduleProxy;\n// Fixes `cannot find name 'global'.` in tests\n// @ts-ignore\nconst ExpoNativeProxy = global.expo?.modules?.NativeModulesProxy;\n\nconst modulesConstantsKey = 'modulesConstants';\nconst exportedMethodsKey = 'exportedMethods';\n\nconst NativeModulesProxy: { [moduleName: string]: ProxyNativeModule } = {};\n\nif (LegacyNativeProxy) {\n  // use JSI proxy if available, fallback to legacy RN proxy\n  const NativeProxy = ExpoNativeProxy ?? LegacyNativeProxy;\n\n  Object.keys(NativeProxy[exportedMethodsKey]).forEach((moduleName) => {\n    // copy constants\n    NativeModulesProxy[moduleName] = NativeProxy[modulesConstantsKey][moduleName] || {};\n\n    // copy methods\n    NativeProxy[exportedMethodsKey][moduleName].forEach((methodInfo) => {\n      NativeModulesProxy[moduleName][methodInfo.name] = (...args: unknown[]): Promise<any> => {\n        // Use the new proxy to call methods on legacy modules, if possible.\n        if (ExpoNativeProxy?.callMethod) {\n          return ExpoNativeProxy.callMethod(moduleName, methodInfo.name, args);\n        }\n\n        // Otherwise fall back to the legacy proxy.\n        // This is deprecated and might be removed in SDK47 or later.\n        const { key, argumentsCount } = methodInfo;\n        if (argumentsCount !== args.length) {\n          return Promise.reject(\n            new Error(\n              `Native method ${moduleName}.${methodInfo.name} expects ${argumentsCount} ${\n                argumentsCount === 1 ? 'argument' : 'arguments'\n              } but received ${args.length}`\n            )\n          );\n        }\n        return LegacyNativeProxy.callMethod(moduleName, key, args);\n      };\n    });\n\n    // These are called by EventEmitter (which is a wrapper for NativeEventEmitter)\n    // only on iOS and they use iOS-specific native module, EXReactNativeEventEmitter.\n    //\n    // On Android only {start,stop}Observing are called on the native module\n    // and these should be exported as Expo methods.\n    //\n    // Before the RN 65, addListener/removeListeners weren't called on Android. However, it no longer stays true.\n    // See https://github.com/facebook/react-native/commit/f5502fbda9fe271ff6e1d0da773a3a8ee206a453.\n    // That's why, we check if the `EXReactNativeEventEmitter` exists and only if yes, we use it in the listener implementation.\n    // Otherwise, those methods are NOOP.\n    if (NativeModules.EXReactNativeEventEmitter) {\n      NativeModulesProxy[moduleName].addListener = (...args) =>\n        NativeModules.EXReactNativeEventEmitter.addProxiedListener(moduleName, ...args);\n      NativeModulesProxy[moduleName].removeListeners = (...args) =>\n        NativeModules.EXReactNativeEventEmitter.removeProxiedListeners(moduleName, ...args);\n    } else {\n      // Fixes on Android:\n      // WARN  `new NativeEventEmitter()` was called with a non-null argument without the required `addListener` method.\n      // WARN  `new NativeEventEmitter()` was called with a non-null argument without the required `removeListeners` method.\n      NativeModulesProxy[moduleName].addListener = () => {};\n      NativeModulesProxy[moduleName].removeListeners = () => {};\n    }\n  });\n} else {\n  console.warn(\n    `The \"EXNativeModulesProxy\" native module is not exported through NativeModules; verify that expo-modules-core's native code is linked properly`\n  );\n}\n\nexport default NativeModulesProxy;\n"],"mappings":"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"}