{"version":3,"names":["_blueimpMd","_interopRequireDefault","require","_expoConstants","FileSystem","_interopRequireWildcard","_expoModulesCore","_AssetUris","_NativeModulesProxy$E","_NativeModulesProxy$E2","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","IS_MANAGED_ENV","Constants","appOwnership","exports","IS_BARE_ENV_WITH_UPDATES","NativeModulesProxy","ExpoUpdates","isEnabled","isUsingEmbeddedAssets","IS_ENV_WITH_UPDATES_ENABLED","IS_BARE_ENV_WITHOUT_UPDATES","getLocalAssets","_NativeModulesProxy$E3","_NativeModulesProxy$E4","localAssets","getManifest","_Constants$__unsafeNo","__unsafeNoWarnManifest","getManifest2","__unsafeNoWarnManifest2","manifestBaseUrl","experienceUrl","getManifestBaseUrl","downloadAsync","_x","_x2","_x3","_x4","_downloadAsync","apply","arguments","_asyncToGenerator2","_regenerator","mark","_callee","uri","hash","type","name","wrap","_callee$","_context","prev","next","abrupt","_downloadAsyncManagedEnv","_downloadAsyncUnmanagedEnv","stop","_x5","_x6","_x7","_x8","_downloadAsyncManagedEnv2","_callee2","cacheFileId","localUri","fileInfo","_yield$FileSystem$dow","md5","_callee2$","_context2","computeMd5","concat","cacheDirectory","getInfoAsync","sent","exists","Error","_x9","_x10","_x11","_downloadAsyncUnmanagedEnv2","_callee3","_callee3$","_context3","startsWith"],"sources":["../src/PlatformUtils.ts"],"sourcesContent":["import computeMd5 from 'blueimp-md5';\nimport Constants from 'expo-constants';\nimport { Manifest } from 'expo-constants/build/Constants.types';\nimport * as FileSystem from 'expo-file-system';\nimport { NativeModulesProxy } from 'expo-modules-core';\n\nimport { getManifestBaseUrl } from './AssetUris';\n\n// Constants.appOwnership is only available in managed apps (Expo client and standalone)\nexport const IS_MANAGED_ENV = !!Constants.appOwnership;\n\n// In the future (SDK38+) expo-updates is likely to be used in managed apps, so we decide\n// that you are in a bare app with updates if you're not in a managed app and you have\n// local assets available.\nexport const IS_BARE_ENV_WITH_UPDATES =\n  !IS_MANAGED_ENV &&\n  !!NativeModulesProxy.ExpoUpdates?.isEnabled &&\n  // if expo-updates is installed but we're running directly from the embedded bundle, we don't want\n  // to override the AssetSourceResolver\n  !NativeModulesProxy.ExpoUpdates?.isUsingEmbeddedAssets;\n\nexport const IS_ENV_WITH_UPDATES_ENABLED = IS_MANAGED_ENV || IS_BARE_ENV_WITH_UPDATES;\n\n// If it's not managed or bare w/ updates, then it must be bare w/o updates!\nexport const IS_BARE_ENV_WITHOUT_UPDATES = !IS_MANAGED_ENV && !IS_BARE_ENV_WITH_UPDATES;\n\n// Get the localAssets property from the ExpoUpdates native module so that we do\n// not need to include expo-updates as a dependency of expo-asset\nexport function getLocalAssets() {\n  return NativeModulesProxy.ExpoUpdates?.localAssets ?? {};\n}\n\nexport function getManifest(): { [key: string]: any } {\n  return Constants.__unsafeNoWarnManifest ?? {};\n}\n\nexport function getManifest2(): Manifest | undefined {\n  return Constants.__unsafeNoWarnManifest2;\n}\n\n// Compute manifest base URL if available\nexport const manifestBaseUrl = Constants.experienceUrl\n  ? getManifestBaseUrl(Constants.experienceUrl)\n  : null;\n\n// TODO: how should this behave in bare app with updates? re: hashAssetFiles\nexport async function downloadAsync(uri, hash, type, name): Promise<string> {\n  if (IS_MANAGED_ENV) {\n    return _downloadAsyncManagedEnv(uri, hash, type, name);\n  }\n\n  return _downloadAsyncUnmanagedEnv(uri, hash, type);\n}\n\n/**\n * Check if the file exists on disk already, perform integrity check if so.\n * Otherwise, download it.\n */\nasync function _downloadAsyncManagedEnv(uri, hash, type, name): Promise<string> {\n  const cacheFileId = hash || computeMd5(uri);\n  const localUri = `${FileSystem.cacheDirectory}ExponentAsset-${cacheFileId}.${type}`;\n  const fileInfo = await FileSystem.getInfoAsync(localUri, {\n    md5: true,\n  });\n  if (!fileInfo.exists || (hash !== null && fileInfo.md5 !== hash)) {\n    const { md5 } = await FileSystem.downloadAsync(uri, localUri, {\n      md5: true,\n    });\n    if (hash !== null && md5 !== hash) {\n      throw new Error(\n        `Downloaded file for asset '${name}.${type}' ` +\n          `Located at ${uri} ` +\n          `failed MD5 integrity check`\n      );\n    }\n  }\n  return localUri;\n}\n\n/**\n * Just download the asset, don't perform integrity check because we don't have\n * the hash to compare it with (we don't have hashAssetFiles plugin). Hash is\n * only used for the file name.\n */\nasync function _downloadAsyncUnmanagedEnv(uri, hash, type): Promise<string> {\n  // TODO: does this make sense to bail out if it's already at a file URL\n  // because it's already available locally?\n  if (uri.startsWith('file://')) {\n    return uri;\n  }\n\n  const cacheFileId = hash || computeMd5(uri);\n  const localUri = `${FileSystem.cacheDirectory}ExponentAsset-${cacheFileId}.${type}`;\n\n  // We don't check the FileSystem for an existing version of the asset and we\n  // also don't perform an integrity check!\n  await FileSystem.downloadAsync(uri, localUri);\n  return localUri;\n}\n"],"mappings":"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"}